{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _ from \"@/assets/utils\";\nexport default {\n  name: \"banner-setting\",\n  data() {\n    const validateRedirect = (_, value, callback) => {\n      if (!value) return callback(new Error('地址不能为空'));\n      let reg = /^(((ht|f)tps?):\\/\\/)?([^!@#$%^&*?.\\s-]([^!@#$%^&*?.\\s]{0,63}[^!@#$%^&*?.\\s])?\\.)+[a-z]{2,6}\\/?/;\n      if (!reg.test(value)) return callback(new Error('地址格式不正确！'));\n      callback();\n    };\n    const validateRank = (_, value, callback) => {\n      if (!value) return callback(new Error('排序值不能为空'));\n      let reg = /^\\d+$/;\n      if (!reg.test(value) || value < 1 || value > 200) return callback(new Error('排序值是1~200之间的整数'));\n      callback();\n    };\n    return {\n      //关于表格区域的\n      tableData: [],\n      tableLoading: false,\n      pageSize: 20,\n      total: 0,\n      currentPage: 1,\n      selection: [],\n      //Dialog表单相关的\n      dialogVisible: false,\n      carouselId: null,\n      ruleFrom: {\n        carouselUrl: '',\n        redirectUrl: 'https://www.baidu.com',\n        carouselRank: 1\n      },\n      rules: {\n        carouselUrl: [{\n          required: true,\n          message: '图片不能为空',\n          trigger: 'blur'\n        }],\n        redirectUrl: [{\n          required: true,\n          validator: validateRedirect,\n          trigger: 'blur'\n        }],\n        carouselRank: [{\n          required: true,\n          validator: validateRank,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.init();\n  },\n  methods: {\n    /* 表格相关的方法 */\n    //根据分页信息，获取轮播图列表\n    async init() {\n      this.tableLoading = true;\n      try {\n        let {\n          resultCode,\n          data\n        } = await this.$api.carousels.queryList(this.currentPage, this.pageSize);\n        if (+resultCode === 200) {\n          let {\n            totalCount,\n            list\n          } = data;\n          this.total = +totalCount;\n          this.tableData = list;\n          this.tableLoading = false;\n          return;\n        }\n      } catch (_) {\n        console.log('错误:', _);\n      }\n      this.tableData = [];\n      this.total = 0;\n      this.tableLoading = false;\n    },\n    //分页器改变\n    paginationChange(num) {\n      this.currentPage = num;\n      this.init();\n    },\n    //时间格式化\n    formatterTime(row) {\n      return _.formatTime(row.createTime, '{0}-{1}-{2}');\n    },\n    /* 表单相关的 */\n    //关闭弹出层\n    closeDialog() {\n      this.$refs.fromIns.resetFields();\n      this.ruleFrom = {\n        carouselUrl: \"\",\n        redirectUrl: \"http://www.baidu.com\",\n        carouselRank: 1\n      };\n      this.carouselId = null;\n      this.dialogVisible = false;\n    },\n    //新增/修改轮播图信息\n    async submit() {\n      try {\n        await this.$refs.fromIns.validate();\n        let func = this.$api.carousels.insert,\n          data = {\n            ...this.ruleFrom\n          };\n        if (this.carouselId) {\n          func = this.$api.carousels.update;\n          data.carouselId = this.carouselId;\n          console.log(data);\n        }\n        let {\n          resultCode\n        } = await func(data);\n        if (+resultCode === 200) {\n          this.closeDialog();\n          this.$message.success('恭喜您，操作成功');\n          this.init();\n          return;\n        } else {\n          this.$message.error('操作失败，请稍后再试！');\n        }\n      } catch (_) {\n        console.log('错误：', _);\n      }\n    },\n    //自定义上传图片\n    async uploadImg({\n      file\n    }) {\n      try {\n        let {\n          resultCode,\n          data\n        } = await this.$api.upload(file);\n        if (+resultCode === 200) {\n          this.ruleFrom.carouselUrl = data;\n          return;\n        }\n      } catch (_) {\n        console.log('错误：', _);\n      }\n      this.$message.error('图片上传失败，请稍后再试！');\n    },\n    //点击修改\n    async handleUpdate(row) {\n      this.dialogVisible = true;\n      this.carouselId = row.carouselId;\n      console.log(row);\n      this.ruleFrom = {\n        carouselUrl: row.carouselUrl,\n        redirectUrl: row.redirectUrl,\n        carouselRank: row.carouselRank\n      };\n    },\n    //删除操作\n    async handleRemove(id) {\n      let ids = [];\n      if (id) {\n        //单一删除\n        ids.push(id);\n      } else {\n        //批量删除\n        ids = this.selection.map(item => item.carouselId);\n      }\n      if (ids.length === 0) {\n        this.$message.warning('请至少选中一项删除！');\n        return;\n      }\n      try {\n        let {\n          resultCode\n        } = await this.$api.carousels.remove(ids);\n        if (+resultCode === 200) {\n          this.$message.success('恭喜您，删除成功！');\n          this.init();\n        } else {\n          this.$message.error('删除失败，请稍后再试！');\n        }\n      } catch (_) {\n        console.log('错误：', _);\n      }\n    },\n    selectionChange(val) {\n      this.selection = val;\n    }\n  }\n};","map":{"version":3,"mappings":";AA2EA;AACA;EACAA;EACAC;IACA;MACA;MACA;MACA;MACAC;IACA;IACA;MACA;MACA;MACA;MACAA;IACA;IACA;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;QACAH;UAAAI;UAAAC;UAAAC;QAAA;QACAL;UAAAG;UAAAG;UAAAD;QAAA;QACAJ;UAAAE;UAAAG;UAAAD;QAAA;MACA;IAEA;EACA;EACAE;IACA;EACA;EACAC;IACA;IACA;IACA;MACA;MACA;QACA;UAAAC;UAAArB;QAAA;QACA;UACA;YAAAsB;YAAAC;UAAA;UACA;UACA;UACA;UACA;QACA;MACA;QACAC;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACA;IACA;IAEA;IACA;IACAC;MACA;MACA;QACAhB;QACAC;QACAC;MACA;MACA;MACA;IAEA;IACA;IACA;MACA;QACA;QAEA;UACAb;YAAA;UAAA;QACA;UACA4B;UACA5B;UACAwB;QACA;QACA;UAAAH;QAAA;QACA;UACA;UACA;UACA;UACA;QACA;UACA;QACA;MAEA;QACAG;MACA;IAEA;IACA;IACA;MAAAK;IAAA;MACA;QAEA;UAAAR;UAAArB;QAAA;QACA;UACA;UACA;QACA;MACA;QACAwB;MACA;MACA;IACA;IACA;IACA;MACA;MACA;MACAA;MACA;QACAb;QACAC;QACAC;MACA;IACA;IACA;IACA;MACA;MACA;QACA;QACAiB;MACA;QACA;QACAA;MACA;MACA;QACA;QACA;MACA;MAEA;QACA;UAAAT;QAAA;QACA;UACA;UACA;QACA;UACA;QACA;MACA;QACAG;MACA;IAEA;IACAO;MACA;IACA;EACA;AACA","names":["name","data","callback","tableData","tableLoading","pageSize","total","currentPage","selection","dialogVisible","carouselId","ruleFrom","carouselUrl","redirectUrl","carouselRank","rules","required","message","trigger","validator","created","methods","resultCode","totalCount","list","console","paginationChange","formatterTime","closeDialog","func","file","ids","selectionChange"],"sourceRoot":"src/views/Home","sources":["BannerSetting.vue"],"sourcesContent":["<template>\r\n  <div class=\"banner-setting\">\r\n    <div class=\"app\">\r\n      <!-- 操控区 -->\r\n      <div class=\"handler-box\">\r\n        <el-button type=\"primary\" icon=\"el-icon-plus\" size=\"small\" @click=\"dialogVisible = true\">\r\n          新增\r\n        </el-button>\r\n\r\n        <el-popconfirm title=\"确定要删除这些选中的数据吗？\" @confirm=\"handleRemove\">\r\n          <el-button type=\"danger\" icon=\"el-icon-delete\" size=\"small\" slot=\"reference\">\r\n            批量删除\r\n          </el-button>\r\n        </el-popconfirm>\r\n      </div>\r\n      <div class=\"content\">\r\n        <!-- 表格区 -->\r\n        <el-table :data=\"tableData\" v-loading=\"false\" height=\"100%\" stripe @selection-change=\"selectionChange\">\r\n          <el-table-column type=\"selection\" min-width=\"5%\" align=\"center\"></el-table-column>\r\n          <el-table-column label=\"轮播图\" min-width=\"15%\">\r\n            <template v-slot=\"{ row }\">\r\n              <el-image :src=\"row.carouselUrl\" :preview-src-list=\"[\r\n                row.carouselUrl,\r\n              ]\"></el-image>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"跳转连接\" min-width=\"30%\" show-overflow-tooltip prop=\"redirectUrl\"></el-table-column>\r\n          <el-table-column label=\"排序值\" min-width=\"10%\" align=\"center\" prop=\"carouselRank\"></el-table-column>\r\n          <el-table-column label=\"添加时间\" min-width=\"20%\" :formatter=\"formatterTime\"></el-table-column>\r\n          <el-table-column label=\"操作\" min-width=\"20%\">\r\n            <template v-slot=\"{ row }\">\r\n              <el-link type=\"success\" @click=\"handleUpdate(row)\">修改</el-link>\r\n              <el-popconfirm title=\"确定要删除本条数据吗？\" @confirm=\"handleRemove(row.carouselId)\">\r\n                <el-link type=\"primary\" slot=\"reference\">删除</el-link>\r\n              </el-popconfirm>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 分页区 -->\r\n        <el-pagination background layout=\"prev, pager, next\" :hide-on-single-page=\"true\" :page-size=\"pageSize\"\r\n          :total=\"total\" :current-page=\"currentPage\" @current-change=\"paginationChange\"></el-pagination>\r\n      </div>\r\n\r\n\r\n      <!-- 新增/修改 -->\r\n      <el-dialog width=\"30%\" :title=\"`${carouselId ? '修改' : '添加'}轮播图`\" :visible=\"dialogVisible\"\r\n        :close-on-click-modal=\"false\" :close-on-press-escape=\"false\" :before-close=\"closeDialog\">\r\n        <el-form label-width=\"100px\" :rules=\"rules\" :model=\"ruleFrom\" ref=\"fromIns\">\r\n          <el-form-item label=\"轮播图图片\" prop=\"carouselUrl\">\r\n            <el-upload class=\"avatar-uploader\" action=\"\" accept=\".jpg,.jpeg,.png,.gif\" :show-file-list=\"false\"\r\n              :multiple=\"false\" :http-request=\"uploadImg\">\r\n\r\n              <img v-if=\"ruleFrom.carouselUrl\" :src=\"ruleFrom.carouselUrl\" class=\"avatar-uploader-img\" alt=\"\" />\r\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n            </el-upload>\r\n          </el-form-item>\r\n          <el-form-item label=\"跳转连接\" prop=\"redirectUrl\">\r\n            <el-input v-model.trim=\"ruleFrom.redirectUrl\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"排序值\" prop=\"carouselRank\">\r\n            <el-input-number v-model.trim=\"ruleFrom.carouselRank\"></el-input-number>\r\n          </el-form-item>\r\n        </el-form>\r\n        <template #footer>\r\n          <my-button type=\"primary\" @click=\"submit\">确认提交信息</my-button>\r\n          <el-button @click=\"closeDialog\">取消</el-button>\r\n        </template>\r\n      </el-dialog>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport _ from \"@/assets/utils\"\r\nexport default {\r\n  name: \"banner-setting\",\r\n  data() {\r\n    const validateRedirect = (_, value, callback) => {\r\n      if (!value) return callback(new Error('地址不能为空'));\r\n      let reg = /^(((ht|f)tps?):\\/\\/)?([^!@#$%^&*?.\\s-]([^!@#$%^&*?.\\s]{0,63}[^!@#$%^&*?.\\s])?\\.)+[a-z]{2,6}\\/?/;\r\n      if (!reg.test(value)) return callback(new Error('地址格式不正确！'));\r\n      callback();\r\n    };\r\n    const validateRank = (_, value, callback) => {\r\n      if (!value) return callback(new Error('排序值不能为空'));\r\n      let reg = /^\\d+$/;\r\n      if (!reg.test(value) || value < 1 || value > 200) return callback(new Error('排序值是1~200之间的整数'));\r\n      callback();\r\n    }\r\n    return {\r\n      //关于表格区域的\r\n      tableData: [],\r\n      tableLoading: false,\r\n      pageSize: 20,\r\n      total: 0,\r\n      currentPage: 1,\r\n      selection: [],\r\n      //Dialog表单相关的\r\n      dialogVisible: false,\r\n      carouselId: null,\r\n      ruleFrom: {\r\n        carouselUrl: '',\r\n        redirectUrl: 'https://www.baidu.com',\r\n        carouselRank: 1\r\n      },\r\n      rules: {\r\n        carouselUrl: [{ required: true, message: '图片不能为空', trigger: 'blur' }],\r\n        redirectUrl: [{ required: true, validator: validateRedirect, trigger: 'blur' }],\r\n        carouselRank: [{ required: true, validator: validateRank, trigger: 'blur' }],\r\n      },\r\n\r\n    }\r\n  },\r\n  created() {\r\n    this.init();\r\n  },\r\n  methods: {\r\n    /* 表格相关的方法 */\r\n    //根据分页信息，获取轮播图列表\r\n    async init() {\r\n      this.tableLoading = true;\r\n      try {\r\n        let { resultCode, data } = await this.$api.carousels.queryList(this.currentPage, this.pageSize);\r\n        if (+resultCode === 200) {\r\n          let { totalCount, list } = data;\r\n          this.total = +totalCount;\r\n          this.tableData = list;\r\n          this.tableLoading = false;\r\n          return;\r\n        }\r\n      } catch (_) {\r\n        console.log('错误:', _);\r\n      }\r\n      this.tableData = [];\r\n      this.total = 0;\r\n      this.tableLoading = false;\r\n    },\r\n    //分页器改变\r\n    paginationChange(num) {\r\n      this.currentPage = num;\r\n      this.init()\r\n    },\r\n    //时间格式化\r\n    formatterTime(row) {\r\n      return _.formatTime(row.createTime, '{0}-{1}-{2}');\r\n    },\r\n\r\n    /* 表单相关的 */\r\n    //关闭弹出层\r\n    closeDialog() {\r\n      this.$refs.fromIns.resetFields();\r\n      this.ruleFrom = {\r\n        carouselUrl: \"\",\r\n        redirectUrl: \"http://www.baidu.com\",\r\n        carouselRank: 1,\r\n      }\r\n      this.carouselId = null;\r\n      this.dialogVisible = false;\r\n\r\n    },\r\n    //新增/修改轮播图信息\r\n    async submit() {\r\n      try {\r\n        await this.$refs.fromIns.validate();\r\n\r\n        let func = this.$api.carousels.insert,\r\n          data = { ...this.ruleFrom };\r\n        if (this.carouselId) {\r\n          func = this.$api.carousels.update;\r\n          data.carouselId = this.carouselId;\r\n          console.log(data);\r\n        }\r\n        let { resultCode } = await func(data)\r\n        if (+resultCode === 200) {\r\n          this.closeDialog();\r\n          this.$message.success('恭喜您，操作成功');\r\n          this.init();\r\n          return;\r\n        } else {\r\n          this.$message.error('操作失败，请稍后再试！');\r\n        }\r\n\r\n      } catch (_) {\r\n        console.log('错误：', _);\r\n      }\r\n\r\n    },\r\n    //自定义上传图片\r\n    async uploadImg({ file }) {\r\n      try {\r\n\r\n        let { resultCode, data } = await this.$api.upload(file);\r\n        if (+resultCode === 200) {\r\n          this.ruleFrom.carouselUrl = data;\r\n          return;\r\n        }\r\n      } catch (_) {\r\n        console.log('错误：', _);\r\n      }\r\n      this.$message.error('图片上传失败，请稍后再试！');\r\n    },\r\n    //点击修改\r\n    async handleUpdate(row) {\r\n      this.dialogVisible = true;\r\n      this.carouselId = row.carouselId;\r\n      console.log(row);\r\n      this.ruleFrom = {\r\n        carouselUrl: row.carouselUrl,\r\n        redirectUrl: row.redirectUrl,\r\n        carouselRank: row.carouselRank,\r\n      }\r\n    },\r\n    //删除操作\r\n    async handleRemove(id) {\r\n      let ids = [];\r\n      if (id) {\r\n        //单一删除\r\n        ids.push(id)\r\n      } else {\r\n        //批量删除\r\n        ids = this.selection.map(item => item.carouselId);\r\n      }\r\n      if (ids.length === 0) {\r\n        this.$message.warning('请至少选中一项删除！');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        let { resultCode } = await this.$api.carousels.remove(ids);\r\n        if (+resultCode === 200) {\r\n          this.$message.success('恭喜您，删除成功！');\r\n          this.init();\r\n        } else {\r\n          this.$message.error('删除失败，请稍后再试！')\r\n        }\r\n      } catch (_) {\r\n        console.log('错误：', _);\r\n      }\r\n\r\n    },\r\n    selectionChange(val) {\r\n      this.selection = val;\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.banner-setting {\r\n  position: relative;\r\n  box-sizing: border-box;\r\n  height: 100%;\r\n  padding: 20px;\r\n  border-radius: 4px;\r\n  border: 1px solid #ebeef5;\r\n  background-color: #fff;\r\n  box-shadow: 0 2px 12px 0 rgb(0 0 0 / 10%);\r\n\r\n  .app {\r\n    padding: 20px;\r\n\r\n    .handler-box {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      z-index: 999;\r\n      display: flex;\r\n      align-items: center;\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n      height: 40px;\r\n\r\n      .el-button {\r\n        margin-right: 10px;\r\n      }\r\n    }\r\n\r\n    .content {\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .content .el-pagination {\r\n      z-index: 999;\r\n      display: flex;\r\n      align-items: center;\r\n      height: 40px;\r\n    }\r\n\r\n    .content .el-table {\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n    }\r\n\r\n    .el-image {\r\n      display: block;\r\n      width: 50px;\r\n      height: 50px;\r\n    }\r\n\r\n    .el-link {\r\n      margin-right: 10px;\r\n    }\r\n\r\n    /deep/.el-dialog__body {\r\n      padding: 10px 20px;\r\n    }\r\n\r\n    /deep/.el-upload {\r\n      display: block;\r\n    }\r\n\r\n    .avatar-uploader-icon,\r\n    .avatar-uploader-img {\r\n      display: block;\r\n      box-sizing: border-box;\r\n      width: 120px;\r\n      height: 120px;\r\n      line-height: 120px;\r\n      font-size: 24px;\r\n      color: #8c939d;\r\n      border: 1px dashed #d9d9d9;\r\n      cursor: pointer;\r\n    }\r\n\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}